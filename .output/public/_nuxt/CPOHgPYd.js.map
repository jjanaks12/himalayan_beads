{"version":3,"file":"CPOHgPYd.js","sources":["../../../../pages/dashboard/settings/_role/form.vue"],"sourcesContent":["<script setup lang=\"ts\">\n    import { Form, Field, ErrorMessage } from 'vee-validate'\n\n    import { roleSchema } from '~/lib/schema/settings.schema'\n    import { usePermissionStore } from '~/store/permission'\n\n    interface RoleFormProps {\n        role?: any | null\n    }\n\n    const props = defineProps<RoleFormProps>()\n    const emit = defineEmits(['update'])\n    const { permissionList } = storeToRefs(usePermissionStore())\n    const { fetch } = usePermissionStore()\n\n    const isLoading = ref(false)\n    const form = ref()\n\n    const onSubmit = (values: any) => {\n        isLoading.value = true\n\n        $fetch(`/api/role`, {\n            method: 'POST',\n            body: { ...values }\n        })\n            .then(() => {\n                emit('update')\n            })\n            .finally(() => {\n                isLoading.value = false\n            })\n    }\n\n    const initializeForm = () => {\n        form.value?.resetForm()\n\n        if (props.role) {\n            form.value?.setFieldValue('id', props.role?.id)\n            form.value?.setFieldValue('name', props.role.name)\n            form.value?.setFieldValue('description', props.role.description || '')\n            form.value?.setFieldValue('permissions', props.role.permissions.map((permission: any) => permission.id))\n        }\n    }\n\n    onMounted(() => {\n        if (permissionList.value.length == 0)\n            fetch()\n\n        form.value?.resetForm()\n    })\n\n    watch(props, () => {\n        initializeForm()\n    }, {\n        deep: true,\n        immediate: true\n    })\n</script>\n\n<template>\n    <Form class=\"form\" :validation-schema=\"roleSchema\" @submit=\"onSubmit\" ref=\"form\">\n        <div class=\"form__group\">\n            <label for=\"rf__name\">Name</label>\n            <Field name=\"name\" type=\"text\" />\n            <ErrorMessage name=\"name\" class=\"input--error\" />\n        </div>\n        <div class=\"form__group\">\n            <label for=\"rf__description\">Description</label>\n            <Field name=\"description\" v-slot=\"{ field }\">\n                <textarea v-bind=\"field\" id=\"rf__description\" />\n            </Field>\n            <ErrorMessage name=\"description\" class=\"input--error\" />\n        </div>\n        <div class=\"form__group\">\n            <strong class=\"label\">Permissions</strong>\n            <div class=\"custom__checkbox__group\">\n                <label class=\"custom__checkbox\" v-for=\"permission in permissionList\">\n                    <Field name=\"permissions\" type=\"checkbox\" v-slot=\"{ field }\" :value=\"permission.id\">\n                        <input type=\"checkbox\" :value=\"permission.id\" v-bind=\"field\" />\n                    </Field>\n                    <span class=\"custom__checkbox__text\">{{ permission.name }}</span>\n                </label>\n            </div>\n            <ErrorMessage name=\"permissions\" class=\"input--error\" />\n        </div>\n        <div class=\"text--right\">\n            <button type=\"submit\" :class=\"{ 'btn btn__primary': true, 'loading': isLoading }\">Save</button>\n        </div>\n    </Form>\n</template>"],"names":["props","__props","emit","__emit","permissionList","storeToRefs","usePermissionStore","fetch","isLoading","ref","form","onSubmit","values","initializeForm","_a","_c","_b","_d","_e","_f","permission","onMounted","watch"],"mappings":"kiBAUI,MAAMA,EAAQC,EACRC,EAAOC,EACP,CAAE,eAAAC,CAAmB,EAAAC,EAAYC,EAAoB,CAAA,EACrD,CAAE,MAAAC,GAAUD,IAEZE,EAAYC,EAAI,EAAK,EACrBC,EAAOD,IAEPE,EAAYC,GAAgB,CAC9BJ,EAAU,MAAQ,GAElB,OAAO,YAAa,CAChB,OAAQ,OACR,KAAM,CAAE,GAAGI,CAAO,CAAA,CACrB,EACI,KAAK,IAAM,CACRV,EAAK,QAAQ,CAAA,CAChB,EACA,QAAQ,IAAM,CACXM,EAAU,MAAQ,EAAA,CACrB,CAAA,EAGHK,EAAiB,IAAM,kBACzBC,EAAAJ,EAAK,QAAL,MAAAI,EAAY,YAERd,EAAM,QACNe,EAAAL,EAAK,QAAL,MAAAK,EAAY,cAAc,MAAMC,EAAAhB,EAAM,OAAN,YAAAgB,EAAY,KAC5CC,EAAAP,EAAK,QAAL,MAAAO,EAAY,cAAc,OAAQjB,EAAM,KAAK,OAC7CkB,EAAAR,EAAK,QAAL,MAAAQ,EAAY,cAAc,cAAelB,EAAM,KAAK,aAAe,KAC9DmB,EAAAT,EAAA,QAAA,MAAAS,EAAO,cAAc,cAAenB,EAAM,KAAK,YAAY,IAAKoB,GAAoBA,EAAW,EAAE,GAC1G,EAGJ,OAAAC,EAAU,IAAM,OACRjB,EAAe,MAAM,QAAU,GACzBG,KAEVO,EAAAJ,EAAK,QAAL,MAAAI,EAAY,WAAU,CACzB,EAEDQ,EAAMtB,EAAO,IAAM,CACAa,GAAA,EAChB,CACC,KAAM,GACN,UAAW,EAAA,CACd"}
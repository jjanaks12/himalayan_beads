{"version":3,"file":"T_x2X1mV.js","sources":["../../../../components/product/form.vue","../../../../components/Pagination.vue","../../../../pages/dashboard/product/index.vue"],"sourcesContent":["<script setup lang=\"ts\">\n    import type { Product } from '@prisma/client'\n    import { Form, Field, ErrorMessage, type SubmissionContext } from 'vee-validate'\n\n    import { productSchema } from '~/lib/schema/product.schema'\n    import { useProductStore } from '~/store/product';\n    import { useProductCategoryStore } from '~/store/productCategory'\n\n    interface ProductFormProps {\n        product?: Product | null\n    }\n    const props = defineProps<ProductFormProps>()\n    const emit = defineEmits(['update-form'])\n    const { fetchCategory } = useProductCategoryStore()\n    const { categoryList } = storeToRefs(useProductCategoryStore())\n    const { saveProduct } = useProductStore()\n\n    const form = ref()\n    const isLoading = ref(false)\n\n    const formSubmit = (values: any, { resetForm }: SubmissionContext) => {\n        isLoading.value = true\n\n        saveProduct(({ ...values }))\n            .then(() => {\n                emit('update-form')\n                resetForm()\n            })\n            .finally(() => {\n                isLoading.value = false\n            })\n    }\n\n    const initializeForm = () => {\n        form.value?.resetForm()\n\n        if (props.product) {\n            form.value?.setFieldValue('id', props.product?.id)\n            form.value?.setFieldValue('name', props.product.name)\n            form.value?.setFieldValue('description', props.product.description || '')\n            form.value?.setFieldValue('category_id', props.product.category_id || '')\n        }\n    }\n\n    watch(props, () => {\n        initializeForm()\n    }, {\n        deep: true,\n        immediate: true\n    })\n\n    onMounted(() => {\n        if (categoryList.value.length == 0)\n            fetchCategory()\n    })\n</script>\n\n<template>\n    <Form class=\"form\" :validation-schema=\"productSchema\" @submit=\"formSubmit\" ref=\"form\">\n        <div class=\"form__group\">\n            <label for=\"pf__name\">Name</label>\n            <Field type=\"text\" name=\"name\" id=\"pf__name\" />\n            <ErrorMessage name=\"name\" class=\"input--error\" />\n        </div>\n        <div class=\"form__group\">\n            <label for=\"cf__category_id\">Category</label>\n            <Field name=\"category_id\" v-slot=\"{ field }\">\n                <select v-bind=\"field\" id=\"cf__category_id\">\n                    <option value=\"\">Select a parent</option>\n                    <template v-for=\"category in categoryList\">\n                        <option :value=\"category.id\">{{ category.name }}</option>\n                        <template v-if=\"category.predecessor.length > 0\">\n                            <option v-for=\"subCategory in category.predecessor\" :value=\"subCategory.id\">&nbsp;&nbsp; {{\n                                subCategory.name }}</option>\n                        </template>\n                    </template>\n                </select>\n            </Field>\n            <ErrorMessage class=\"input--error\" name=\"category_id\" />\n        </div>\n        <div class=\"text--right\">\n            <button type=\"submit\" :class=\"{ 'btn btn__primary': true, 'loading': isLoading }\">Save</button>\n        </div>\n    </Form>\n</template>","<script lang=\"ts\" setup>\n  interface PaginationProps {\n    total: number\n    current: number\n    onNext: any\n    onPrev: any\n    onGoto: any\n    max?: number\n  }\n\n  const props = withDefaults(defineProps<PaginationProps>(), {\n    max: 3\n  })\n\n  const pages = computed(() => {\n    let length = props.max\n\n    if (length > props.total)\n      length = props.total\n\n    let start = props.current - Math.floor(length / 2)\n    start = Math.max(start, 1)\n    start = Math.min(start, 1 + props.total - length)\n    \n    return Array.from({ length }, (_, i) => start + i)\n  })\n</script>\n\n<template>\n  <div class=\"pagination\" v-if=\"total > 1\">\n    <button type=\"button\" @click=\"onPrev\" :disabled=\"current == 1\">\n      <MdiIcon preserveAspectRatio=\"xMidYMid meet\" icon=\"mdiChevronLeft\" size=\"18\" />\n    </button>\n    <ul>\n      <li v-for=\"page in pages\">\n        <strong v-if=\"page == current\">{{ page }}</strong>\n        <a href=\"#\" @click.prevent=\"onGoto(page)\" v-else>{{ page }}</a>\n      </li>\n    </ul>\n    <button type=\"button\" @click=\"onNext\" :disabled=\"current == total\">\n      <MdiIcon preserveAspectRatio=\"xMidYMid meet\" icon=\"mdiChevronRight\" size=\"18\" />\n    </button>\n  </div>\n  <div class=\"pagination\" v-else>\n    <p class=\"pagination__text\">No more pages</p>\n  </div>\n</template>\n","<script lang=\"ts\" setup>\n    import type { Product } from '@prisma/client'\n\n    import { useProductStore } from '@/store/product'\n    import { formatDate } from '~/lib/filter'\n    import ProductItem from './_component/Item.vue'\n\n    import ProductForm from '@/components/product/form.vue'\n    import Alert from '~/components/Alert.vue'\n    import Modal from '~/components/Modal.vue'\n    import Pagination from '~/components/Pagination.vue'\n\n    useHead({\n        title: 'Products :: Himalayan Beads'\n    })\n\n    definePageMeta({\n        layout: 'admin',\n        middleware: ['auth', 'authorization'],\n        permission: 'view_product'\n    })\n\n    const { fetchProduct, nextPage, prevPage, gotoPage } = useProductStore()\n    const { productList, isLoading, param, query } = storeToRefs(useProductStore())\n\n    const isDeleting = ref(false)\n    const showForm = ref(false)\n    const editProduct = ref<null | Product>(null)\n    const deletingProduct = ref<null | Product>(null)\n\n    const showDeleteAlert = computed(() => deletingProduct.value != null)\n\n    const deleteProduct = async () => {\n        isDeleting.value = true\n\n        await $fetch(`/api/category/${deletingProduct.value?.id}/`, {\n            method: 'DELETE'\n        })\n            .then(() => {\n                deletingProduct.value = null\n                fetchProduct()\n            })\n            .finally(() => {\n                isDeleting.value = false\n            })\n    }\n\n    watch(editProduct, () => {\n        if (editProduct.value)\n            showForm.value = true\n        else\n            showForm.value = false\n    })\n</script>\n\n<template>\n    <section class=\"datatable__section\">\n        <header class=\"datatable__header\">\n            <div class=\"datatable__header__holder\">\n                <h1>Product</h1>\n            </div>\n            <div class=\"datatable__header__action\">\n                <form action=\"#\" class=\"search__form\">\n                    <div class=\"form__group\">\n                        <label for=\"sf__search\">Search product</label>\n                        <input type=\"search\" name=\"s\" id=\"sf__search\" v-model=\"query.s\"\n                            placeholder=\"Search text here...\">\n                    </div>\n                    <button type=\"submit\">\n                        <MdiIcon preserveAspectRatio=\"xMidYMid meet\" icon=\"mdiMagnify\" size=\"24\" />\n                    </button>\n                </form>\n                <a class=\"btn btn__primary btn--icon\" href=\"#\" @click.prevent=\"fetchProduct\" :disabled=\"isLoading\">\n                    <MdiIcon preserveAspectRatio=\"xMidYMid meet\" icon=\"mdiReload\" size=\"16\" />\n                </a>\n                <a class=\"btn btn__primary\" href=\"#\" @click.prevent=\"showForm = true\">\n                    <span class=\"prepend-icon icon-add\"></span>\n                    Add Product\n                </a>\n            </div>\n        </header>\n        <div class=\"datatable__filter\">\n            <form action=\"#\" class=\"search__form\"></form>\n        </div>\n        <div class=\"datatable__body\">\n            <table>\n                <thead>\n                    <tr>\n                        <th></th>\n                        <th class=\"text--left\">Name</th>\n                        <th>Created at</th>\n                        <th class=\"text--right\">Action</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    <template v-if=\"!isLoading\">\n                        <tr v-for=\"(product, index) in productList\" :key=\"product.id\">\n                            <td class=\"sn\">{{ index + 1 }}</td>\n                            <td>\n                                <product-item :product=\"product\" />\n                            </td>\n                            <td class=\"text--center\">{{ formatDate(product.createdAt) }}</td>\n                            <td class=\"text--right\">\n                                <ThemeButton size=\"xs\" @click=\"editProduct = product\" persmission=\"update_product\">\n                                    <MdiIcon preserveAspectRatio=\"xMidYMid meet\" icon=\"mdiPencil\" size=\"16\" />\n                                    Edit\n                                </ThemeButton>\n                                <ThemeButton size=\"xs\" @click=\"deletingProduct = product\" type=\"danger\"\n                                    persmission=\"delete_product\">\n                                    <MdiIcon preserveAspectRatio=\"xMidYMid meet\" icon=\"mdiDelete\" size=\"16\" />\n                                    Delete\n                                </ThemeButton>\n                            </td>\n                        </tr>\n                    </template>\n                    <template v-else>\n                        <DatatableLoading :column=\"4\" :row=\"3\" />\n                    </template>\n                </tbody>\n            </table>\n        </div>\n        <footer class=\"datatable__footer\">\n            <Pagination :current=\"query.current\" :total=\"param?.total_page || 0\" :onNext=\"nextPage\" :onPrev=\"prevPage\"\n                :onGoto=\"gotoPage\" />\n        </footer>\n        <Modal v-model:show=\"showForm\" @modal:close=\"editProduct = null\">\n            <ProductForm :product=\"editProduct || null\" @update-form=\"() => {\n                showForm = false\n                fetchProduct()\n            }\" />\n        </Modal>\n        <Alert title=\"Are you sure you want delete?\" v-model:show=\"showDeleteAlert\" v-model:loading=\"isDeleting\"\n            :onCancel=\"() => {\n                deletingProduct = null\n            }\" :onConfirm=\"deleteProduct\">\n            <p>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Aliquid quo, explicabo necessitatibus\n                laboriosam a\n                voluptatem hic ratione eius excepturi doloremque quidem odit eaque blanditiis illo obcaecati. Dicta\n                adipisci\n                accusantium quidem.</p>\n        </Alert>\n    </section>\n</template>"],"names":["props","__props","emit","__emit","fetchCategory","useProductCategoryStore","categoryList","storeToRefs","saveProduct","useProductStore","form","ref","isLoading","formSubmit","values","resetForm","initializeForm","_a","_c","_b","_d","_e","_f","watch","onMounted","pages","computed","length","start","_","i","useHead","fetchProduct","nextPage","prevPage","gotoPage","productList","param","query","isDeleting","showForm","editProduct","deletingProduct","showDeleteAlert","deleteProduct"],"mappings":"4lCAWI,MAAMA,EAAQC,EACRC,EAAOC,EACP,CAAE,cAAAC,GAAkBC,IACpB,CAAE,aAAAC,CAAiB,EAAAC,EAAYF,EAAyB,CAAA,EACxD,CAAE,YAAAG,GAAgBC,IAElBC,EAAOC,IACPC,EAAYD,EAAI,EAAK,EAErBE,EAAa,CAACC,EAAa,CAAE,UAAAC,KAAmC,CAClEH,EAAU,MAAQ,GAElBJ,EAAa,CAAE,GAAGM,EAAS,EACtB,KAAK,IAAM,CACRZ,EAAK,aAAa,EACRa,GAAA,CACb,EACA,QAAQ,IAAM,CACXH,EAAU,MAAQ,EAAA,CACrB,CAAA,EAGHI,EAAiB,IAAM,kBACzBC,EAAAP,EAAK,QAAL,MAAAO,EAAY,YAERjB,EAAM,WACNkB,EAAAR,EAAK,QAAL,MAAAQ,EAAY,cAAc,MAAMC,EAAAnB,EAAM,UAAN,YAAAmB,EAAe,KAC/CC,EAAAV,EAAK,QAAL,MAAAU,EAAY,cAAc,OAAQpB,EAAM,QAAQ,OAChDqB,EAAAX,EAAK,QAAL,MAAAW,EAAY,cAAc,cAAerB,EAAM,QAAQ,aAAe,KACtEsB,EAAAZ,EAAK,QAAL,MAAAY,EAAY,cAAc,cAAetB,EAAM,QAAQ,aAAe,IAC1E,EAGJ,OAAAuB,EAAMvB,EAAO,IAAM,CACAgB,GAAA,EAChB,CACC,KAAM,GACN,UAAW,EAAA,CACd,EAEDQ,EAAU,IAAM,CACRlB,EAAa,MAAM,QAAU,GACfF,GAAA,CACrB,mnCC5CH,MAAMJ,EAAQC,EAIRwB,EAAQC,EAAS,IAAM,CAC3B,IAAIC,EAAS3B,EAAM,IAEf2B,EAAS3B,EAAM,QACjB2B,EAAS3B,EAAM,OAEjB,IAAI4B,EAAQ5B,EAAM,QAAU,KAAK,MAAM2B,EAAS,CAAC,EACzC,OAAAC,EAAA,KAAK,IAAIA,EAAO,CAAC,EACzBA,EAAQ,KAAK,IAAIA,EAAO,EAAI5B,EAAM,MAAQ2B,CAAM,EAEzC,MAAM,KAAK,CAAE,OAAAA,GAAU,CAACE,EAAGC,IAAMF,EAAQE,CAAC,CAAA,CAClD,ojCCbSC,GAAA,CACJ,MAAO,6BAAA,CACV,EAQD,KAAM,CAAE,aAAAC,EAAc,SAAAC,EAAU,SAAAC,EAAU,SAAAC,CAAA,EAAa1B,IACjD,CAAE,YAAA2B,EAAa,UAAAxB,EAAW,MAAAyB,EAAO,MAAAC,GAAU/B,EAAYE,GAAiB,EAExE8B,EAAa5B,EAAI,EAAK,EACtB6B,EAAW7B,EAAI,EAAK,EACpB8B,EAAc9B,EAAoB,IAAI,EACtC+B,EAAkB/B,EAAoB,IAAI,EAE1CgC,EAAkBjB,EAAS,IAAMgB,EAAgB,OAAS,IAAI,EAE9DE,EAAgB,SAAY,OAC9BL,EAAW,MAAQ,GAEnB,MAAM,OAAO,kBAAiBtB,EAAAyB,EAAgB,QAAhB,YAAAzB,EAAuB,EAAE,IAAK,CACxD,OAAQ,QAAA,CACX,EACI,KAAK,IAAM,CACRyB,EAAgB,MAAQ,KACXV,GAAA,CAChB,EACA,QAAQ,IAAM,CACXO,EAAW,MAAQ,EAAA,CACtB,CAAA,EAGT,OAAAhB,EAAMkB,EAAa,IAAM,CACjBA,EAAY,MACZD,EAAS,MAAQ,GAEjBA,EAAS,MAAQ,EAAA,CACxB"}
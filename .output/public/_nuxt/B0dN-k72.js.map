{"version":3,"file":"B0dN-k72.js","sources":["../../../../components/Confirm.vue","../../../../pages/dashboard/product/_component/imageBlock.vue"],"sourcesContent":["<script lang=\"ts\" setup>\n  import * as Icons from '@mdi/js'\n\n  interface ConfirmDialogProps {\n    title: string\n    text?: string\n    icon?: keyof typeof Icons\n    confirmText?: string\n    cancelText?: string\n  }\n\n  const emit = defineEmits(['confirmed', 'canceled'])\n  const props = withDefaults(defineProps<ConfirmDialogProps>(), {\n    icon: 'mdiHelpCircle',\n    cancelText: 'No',\n    confirmText: 'Yes',\n  })\n\n  const showConfirm = defineModel('show', {\n    required: true,\n    default: false\n  })\n\n  const confirmAction = () => {\n    emit('confirmed')\n  }\n\n  const cancelAction = () => {\n    emit('canceled')\n    showConfirm.value = false\n  }\n</script>\n\n<template>\n  <Modal :show=\"showConfirm\" @modal:close=\"cancelAction\">\n    <div class=\"confirm__dialog\">\n      <div class=\"icon__holder\" v-if=\"icon\">\n        <MdiIcon :icon=\"icon\" size=\"64\" />\n      </div>\n      <h2>{{ title }}</h2>\n      <div class=\"text__holder\">\n        <p>{{ text }}</p>\n      </div>\n      <div class=\"confirm__dialog__action\">\n        <a href=\"#\" class=\"btn btn__primary btn--outline\" @click.prevent=\"cancelAction\">\n          <MdiIcon icon=\"mdiClose\" />\n          {{ cancelText }}\n        </a>\n        <a href=\"#\" class=\"btn btn__primary\" @click.prevent=\"confirmAction\">\n          <MdiIcon icon=\"mdiCheck\" />\n          {{ confirmText }}\n        </a>\n      </div>\n    </div>\n  </Modal>\n</template>\n","<script setup lang=\"ts\">\n    import type { ProductWithImage } from '~/store/product'\n    import Dropdown from '~/components/Dropdown.vue'\n\n    interface ImageBlockProps {\n        id: string,\n        images: ProductWithImage[]\n    }\n\n    const props = defineProps<ImageBlockProps>()\n    const emit = defineEmits(['update'])\n    const { files, handleFileInput } = useFileStorage()\n\n    const isLoading = ref(false)\n    const showViewModal = ref(false)\n    const viewImage = ref<string | null>(null)\n\n    const deleteImageID = ref<string | null>(null)\n    const showDeleteConfirm = ref(false)\n\n    const loading = ref<{ [propsName: string]: boolean }>({})\n\n    const saveImages = () => {\n        isLoading.value = true\n\n        $fetch(`/api/product/${props.id}/images`, {\n            method: 'POST',\n            body: {\n                files: files.value,\n                product_id: props.id\n            }\n        })\n            .then(() => {\n                files.value = []\n                emit('update')\n            })\n            .finally(() => {\n                isLoading.value = false\n            })\n    }\n\n    const deleteImage = async () => {\n        if (deleteImageID.value) {\n            loading.value[deleteImageID.value] = true\n\n            await $fetch(`/api/product/${props.id}/images/${deleteImageID.value}`, {\n                method: 'delete'\n            })\n                .then((a) => {\n                    if (a.status == 'success') {\n                        emit('update')\n                    }\n                })\n                .finally(() => {\n                    if (deleteImageID.value) {\n                        loading.value[deleteImageID.value] = false\n                        deleteImageID.value = null\n                    }\n                })\n        }\n    }\n\n    const setAsFeatured = async (id: string) => {\n        loading.value[id] = true\n\n        await $fetch(`/api/product/${props.id}/images/${id}`, {\n            method: 'put'\n        })\n            .then((a) => {\n                if (a.status == 'success') {\n                    emit('update')\n                }\n            })\n            .finally(() => {\n                loading.value[id] = false\n            })\n    }\n\n    watch(viewImage, () => {\n        showViewModal.value = viewImage.value != null\n    })\n\n    watch(deleteImageID, () => {\n        showDeleteConfirm.value = deleteImageID.value != null\n    })\n</script>\n\n<template>\n    <div class=\"content__body\">\n        <div class=\"content__block__title\">\n            <h2>Images</h2>\n        </div>\n        <div class=\"image__section\">\n            <label class=\"custom__file\">\n                <input type=\"file\" @change=\"handleFileInput\" name=\"file\" multiple accept=\"image/*\" />\n                <div :class=\"{ 'custom__file__text': true, 'custom__file__text--has__files': files.length > 0 }\">\n                    <ol class=\"custom__file__list\">\n                        <template v-if=\"files.length > 0\">\n                            <li class=\"custom__file__list__item\" v-for=\"(file, index) in files\">\n                                <img :src=\"file.content\" :alt=\"file.name\">\n                                <a href=\"#\" @click.prevent=\"files.splice(index, 1)\"><span class=\"icon-add\"></span></a>\n                            </li>\n                            <li class=\"custom__file__list__item custom__file__list__item--last\">\n                                <div class=\"holder\">\n                                    <span>You have selected {{ files.length }} image{{ files.length > 1 ? 's' : ''\n                                        }}</span>\n                                    <button :class=\"{ 'btn btn__primary': true, 'loading': isLoading }\"\n                                        @click=\"saveImages\">\n                                        save images\n                                    </button>\n                                </div>\n                            </li>\n                        </template>\n                        <li class=\"custom__file__list__item\" v-else>\n                            <strong>Upload files</strong>\n                            <em>(You can choose multiple images)</em>\n                        </li>\n                    </ol>\n                </div>\n            </label>\n            <div class=\"image__list\">\n                <figure :class=\"{ 'image': true, 'image--featured': image.featured }\" v-for=\"image in images\">\n                    <img :src=\"(image.images?.url as string)\" alt=\"image description\">\n                    <div class=\"image__action\">\n                        <span class=\"image__action__item\" v-if=\"image.featured\">\n                            <MdiIcon icon=\"mdiStar\" class=\"featured--icon text--warning\" />\n                        </span>\n                        <Dropdown as=\"ul\">\n                            <template v-slot:opener=\"{ clickHandler }\">\n                                <a href=\"#\"\n                                    :class=\"{ 'dropdown__opener image__action__item image__action__item--link': true, 'loading': loading[image.id] }\"\n                                    @click.prevent=\"clickHandler\">\n                                    <MdiIcon icon=\"mdiDotsVertical\" size=\"24\" v-if=\"!loading[image.id]\" />\n                                </a>\n                            </template>\n                            <li>\n                                <a href=\"#\" @click.prevent=\"deleteImageID = image.id\">\n                                    Delete\n                                    <MdiIcon icon=\"mdiTrashCan\" />\n                                </a>\n                            </li>\n                            <li>\n                                <a href=\"#\" @click=\"viewImage = (image.images?.url as string)\">\n                                    view\n                                    <MdiIcon icon=\"mdiEye\" />\n                                </a>\n                            </li>\n                            <li v-if=\"!image.featured\">\n                                <a href=\"#\" @click.prevent=\"setAsFeatured(image.id)\">\n                                    Set as featured\n                                    <MdiIcon icon=\"mdiStarCircleOutline\" />\n                                </a>\n                            </li>\n                        </Dropdown>\n                    </div>\n                </figure>\n            </div>\n            <Modal :show=\"showViewModal\" size=\"xl\" @modal:close=\"viewImage = null\">\n                <div class=\"image__holder\" v-if=\"viewImage\">\n                    <img :src=\"viewImage\" alt=\"image description\">\n                </div>\n            </Modal>\n\n            <Confirm :show=\"showDeleteConfirm\" title=\"Are you sure you want to delete?\"\n                text=\"Once you delete this image you cannot go back.\" @confirmed=\"deleteImage\"\n                @canceled=\"deleteImageID = null\" cancel-text=\"No, not now\" confirm-text=\"Yes, delete it\" />\n        </div>\n    </div>\n</template>\n\n<style scoped>\n    .image__holder img {\n        max-width: 100%\n    }\n</style>"],"names":["emit","__emit","showConfirm","_useModel","__props","confirmAction","cancelAction","props","files","handleFileInput","useFileStorage","isLoading","ref","showViewModal","viewImage","deleteImageID","showDeleteConfirm","loading","saveImages","deleteImage","a","setAsFeatured","id","watch"],"mappings":"+rBAWE,MAAMA,EAAOC,EAOPC,EAAcC,EAAYC,EAAA,MAG/B,EAEKC,EAAgB,IAAM,CAC1BL,EAAK,WAAW,CAAA,EAGZM,EAAe,IAAM,CACzBN,EAAK,UAAU,EACfE,EAAY,MAAQ,EAAA,ioCCpBpB,MAAMK,EAAQH,EACRJ,EAAOC,EACP,CAAE,MAAAO,EAAO,gBAAAC,CAAgB,EAAIC,EAAe,EAE5CC,EAAYC,EAAI,EAAK,EACrBC,EAAgBD,EAAI,EAAK,EACzBE,EAAYF,EAAmB,IAAI,EAEnCG,EAAgBH,EAAmB,IAAI,EACvCI,EAAoBJ,EAAI,EAAK,EAE7BK,EAAUL,EAAsC,CAAA,CAAE,EAElDM,EAAa,IAAM,CACrBP,EAAU,MAAQ,GAEX,OAAA,gBAAgBJ,EAAM,EAAE,UAAW,CACtC,OAAQ,OACR,KAAM,CACF,MAAOC,EAAM,MACb,WAAYD,EAAM,EACtB,CAAA,CACH,EACI,KAAK,IAAM,CACRC,EAAM,MAAQ,GACdR,EAAK,QAAQ,CAAA,CAChB,EACA,QAAQ,IAAM,CACXW,EAAU,MAAQ,EAAA,CACrB,CAAA,EAGHQ,EAAc,SAAY,CACxBJ,EAAc,QACNE,EAAA,MAAMF,EAAc,KAAK,EAAI,GAErC,MAAM,OAAO,gBAAgBR,EAAM,EAAE,WAAWQ,EAAc,KAAK,GAAI,CACnE,OAAQ,QAAA,CACX,EACI,KAAMK,GAAM,CACLA,EAAE,QAAU,WACZpB,EAAK,QAAQ,CACjB,CACH,EACA,QAAQ,IAAM,CACPe,EAAc,QACNE,EAAA,MAAMF,EAAc,KAAK,EAAI,GACrCA,EAAc,MAAQ,KAC1B,CACH,EACT,EAGEM,EAAgB,MAAOC,GAAe,CAChCL,EAAA,MAAMK,CAAE,EAAI,GAEpB,MAAM,OAAO,gBAAgBf,EAAM,EAAE,WAAWe,CAAE,GAAI,CAClD,OAAQ,KAAA,CACX,EACI,KAAMF,GAAM,CACLA,EAAE,QAAU,WACZpB,EAAK,QAAQ,CACjB,CACH,EACA,QAAQ,IAAM,CACHiB,EAAA,MAAMK,CAAE,EAAI,EAAA,CACvB,CAAA,EAGT,OAAAC,EAAMT,EAAW,IAAM,CACLD,EAAA,MAAQC,EAAU,OAAS,IAAA,CAC5C,EAEDS,EAAMR,EAAe,IAAM,CACLC,EAAA,MAAQD,EAAc,OAAS,IAAA,CACpD"}
{"version":3,"file":"D7GgLMdG.js","sources":["../../../../store/cart.ts"],"sourcesContent":["import type { Product } from '@prisma/client'\nimport { defineStore } from 'pinia'\nimport type { CartItem, FullProduct, ProductWithRate } from '~/himalayan_beads'\n\nexport const useCartStore = defineStore('cart', () => {\n  const list = ref<CartItem<ProductWithRate>[]>([])\n  const isLoading = ref(false)\n\n  const addToCart = ({ prices, ...product }: FullProduct) => {\n    list.value.push({\n      product: {\n        ...product,\n        prices,\n        rate: prices[prices.length - 1].price\n      }, quantity: 1\n    })\n  }\n\n  const removeFromCart = (product_id: string) => {\n    const ci: any = list.value.find((cartItem: CartItem<Product>) => cartItem?.product?.id === product_id)\n    const index = list.value.indexOf(ci)\n\n    if (index >= 0)\n      list.value.splice(index, 1)\n  }\n\n  const isInCart = (product_id: string) => {\n    const ci: any = list.value.find((cartItem: CartItem<Product>) => cartItem?.product?.id === product_id)\n    return ci != null\n  }\n\n  const checkout = async () => {\n    isLoading.value = true\n    await $fetch('/api/cart/checkout', {\n      method: 'POST',\n      body: list.value\n    })\n      .finally(() => {\n        isLoading.value = false\n      })\n  }\n\n  return { list, isLoading, addToCart, removeFromCart, isInCart, checkout }\n}, {\n  persist: [{\n    storage: persistedState.localStorage,\n    pick: ['list']\n  }]\n})\n"],"names":["useCartStore","defineStore","list","ref","isLoading","prices","product","product_id","ci","cartItem","_a","index","persistedState"],"mappings":"4CAIa,MAAAA,EAAeC,EAAY,OAAQ,IAAM,CAC9C,MAAAC,EAAOC,EAAiC,CAAA,CAAE,EAC1CC,EAAYD,EAAI,EAAK,EAoC3B,MAAO,CAAE,KAAAD,EAAM,UAAAE,EAAW,UAlCR,CAAC,CAAE,OAAAC,EAAQ,GAAGC,KAA2B,CACzDJ,EAAK,MAAM,KAAK,CACd,QAAS,CACP,GAAGI,EACH,OAAAD,EACA,KAAMA,EAAOA,EAAO,OAAS,CAAC,EAAE,KAClC,EAAG,SAAU,CAAA,CACd,CAAA,EA2BkC,eAxBbE,GAAuB,CACvC,MAAAC,EAAUN,EAAK,MAAM,KAAMO,GAAgC,OAAA,QAAAC,EAAAD,GAAA,YAAAA,EAAU,UAAV,YAAAC,EAAmB,MAAOH,EAAU,EAC/FI,EAAQT,EAAK,MAAM,QAAQM,CAAE,EAE/BG,GAAS,GACNT,EAAA,MAAM,OAAOS,EAAO,CAAC,CAAA,EAmBuB,SAhBnCJ,GACAL,EAAK,MAAM,KAAMO,GAAgC,OAAA,QAAAC,EAAAD,GAAA,YAAAA,EAAU,UAAV,YAAAC,EAAmB,MAAOH,EAAU,GACxF,KAcgD,SAX9C,SAAY,CAC3BH,EAAU,MAAQ,GAClB,MAAM,OAAO,qBAAsB,CACjC,OAAQ,OACR,KAAMF,EAAK,KAAA,CACZ,EACE,QAAQ,IAAM,CACbE,EAAU,MAAQ,EAAA,CACnB,CAAA,EAIP,EAAG,CACD,QAAS,CAAC,CACR,QAASQ,EAAe,aACxB,KAAM,CAAC,MAAM,CAAA,CACd,CACH,CAAC"}